# 设计师快速入门指南

> **目标受众**: 游戏设计师（非技术人员）
> **工具名称**: dbxmlTool - Aion游戏配置数据管理工具
> **更新日期**: 2025-12-29

---

## 📌 一分钟快速开始

### 你是设计师，你想做什么？

<table>
<tr>
<td><b>修改游戏数据</b></td>
<td>打开工具 → 左侧选择文件 → 修改右侧数据 → 点击"保存" → 点击"dbtoxml导出" → 完成！</td>
</tr>
<tr>
<td><b>查找某个道具</b></td>
<td>打开"Aion机制浏览器" → 点击"ITEM物品系统" → 点击items → 在搜索框输入道具名称 → 找到!</td>
</tr>
<tr>
<td><b>批量导出一类数据</b></td>
<td>打开"Aion机制浏览器" → 右键点击某个机制（如"PVP系统"）→ "批量导出" → 完成！</td>
</tr>
<tr>
<td><b>从XML导入数据</b></td>
<td>左侧选择文件 → 点击"xmltodb导入" → 等待完成 → 数据已更新到数据库！</td>
</tr>
</table>

---

## 🎯 核心功能说明

### 1. 主界面 - 数据库↔XML转换

**启动方式**：双击 `run.bat` 或 `启动工具.bat`

**界面布局**：
```
┌─────────────────────────────────────────────────────┐
│  [工具栏] 新建 编辑 删除 刷新 导入 导出 保存      │
├──────────┬──────────────────────────────────────────┤
│          │                                          │
│  左侧：  │           右侧：                         │
│  文件树  │           数据表格                       │
│          │           (可编辑)                       │
│  📁items │  ┌───────┬────────┬────────┬──────┐     │
│  📁npcs  │  │  id   │  name  │  level │ ...  │     │
│  📁skills│  ├───────┼────────┼────────┼──────┤     │
│  ...     │  │ 12345 │ 宝剑   │  50    │ ...  │     │
│          │  └───────┴────────┴────────┴──────┘     │
│          │                                          │
│          │  [xmltodb导入] [dbtoxml导出] [保存]     │
└──────────┴──────────────────────────────────────────┘
```

**核心操作流程**：
1. **查看数据** - 点击左侧文件树
2. **修改数据** - 双击右侧表格单元格，输入新值
3. **保存修改** - 点击"保存"按钮（保存到数据库）
4. **导出XML** - 点击"dbtoxml导出"（生成XML文件给服务器使用）

**⚠️ 重要提示**：
- **修改后必须先保存**，再导出！
- 导出的XML文件保存在 `data/TEMP/` 目录
- 服务器只认识XML文件，不认识数据库！

---

### 2. Aion机制浏览器 - 按游戏系统分类

**打开方式**：主界面工具栏 → "Aion机制浏览器"

**27个游戏机制分类**：

| 机制 | 包含内容 | 文件数 |
|------|---------|--------|
| **ITEM** | 物品、装备、强化、合成、分解 | ~600 |
| **SKILL** | 技能、烙印、充能 | ~200 |
| **NPC** | NPC数据、商店、AI | ~3,500 |
| **QUEST** | 任务、奖励 | ~300 |
| **PET** | 宠物、契约兽 | ~40 |
| **ABYSS** | 深渊、作战点、迷雾时间 | ~80 |
| **PVP** | PVP等级、经验、排行 | ~60 |
| **INSTANCE** | 副本、地图 | ~450 |
| **GUILD** | 军团、领地 | ~15 |
| **HOUSING** | 房屋系统 | ~25 |
| ... | 其他17个机制 | ... |

**操作方式**：
- **单击卡片** - 展开该机制下的所有文件
- **右键文件** - 快捷菜单（导入/导出/编辑）
- **右键机制** - 批量操作（批量导入/导出/DDL生成）

**批量操作示例**：
```
右键点击 "PVP系统" → "批量导出 (DB→XML)"
↓
自动导出所有PVP相关的XML文件：
  ✅ pvp_rank.xml
  ✅ pvp_exp_table.xml
  ✅ pvp_mod_table.xml
  ✅ ...
↓
导出完成！文件保存在 data/TEMP/ 目录
```

---

### 3. 智能验证 - 导出前自动检查

**自动检查项目**：
- ✅ 表是否存在
- ✅ 数据量检查（空表警告）
- ✅ 服务器兼容性检查（自动移除不兼容字段）
- ✅ 引用完整性检查（如任务引用不存在的物品）

**导出日志示例**：
```
ℹ️ 正在进行导出前检查...
ℹ️ 预检查完成: 7个可导出, 2个有警告
⚠️ 发现 2 个表有潜在问题，但仍将尝试导出

[1/7] 正在导出: pvp_exp_mod_table
     数据量: 120 行
✅ [1/7] pvp_exp_mod_table - 导出成功 (12.45 KB)

[2/7] 正在导出: pvp_exp_table
     数据量: 450 行
✅ [2/7] pvp_exp_table - 导出成功 (45.67 KB)

[3/7] 正在导出: test_empty
⚠️ [3/7] test_empty - 跳过（空表）
```

---

## 🔧 常见操作手册

### 修改物品属性

**场景**：修改ID为100200的宝剑的等级要求从50级改为45级

**步骤**：
1. 打开主界面
2. 左侧文件树 → 展开"Item" → 点击"items"
3. 等待数据加载（如果数据很多，会有进度条）
4. 右侧表格 → 使用搜索功能找到ID=100200的记录
5. 双击"level"列的单元格，输入"45"
6. 点击"保存"按钮
7. 点击"dbtoxml导出"按钮
8. 导出完成后，XML文件在 `data/TEMP/items.xml`

**验证**：
- 打开 `data/TEMP/items.xml`
- 搜索 `id="100200"`
- 确认 `level="45"`

---

### 批量修改任务奖励

**场景**：修改所有50级任务的经验奖励，从10000改为15000

**步骤**：
1. 打开主界面
2. 左侧文件树 → 点击"quest"
3. 右侧表格 → 点击"level"列头 → 排序
4. 找到所有level=50的任务
5. 逐个修改exp_reward字段（或使用批量替换功能）
6. 保存 → 导出

**高级技巧**：
- 可以先导出到Excel，在Excel中批量修改，再导入回数据库

---

### 添加新物品

**场景**：添加一把新的50级宝剑

**步骤**：
1. 打开主界面 → 左侧点击"items"
2. 点击"新增"按钮
3. 填写必填字段：
   - `id` - 物品ID（必须唯一，建议从200000开始）
   - `name` - 物品名称
   - `level` - 等级要求
   - `weapon_type` - 武器类型（1=剑）
   - `attack_min` - 最小攻击力
   - `attack_max` - 最大攻击力
   - `price` - 价格
4. 点击"保存"
5. 点击"dbtoxml导出"

**⚠️ 注意事项**：
- ID不能与现有物品重复
- 所有必填字段都必须填写
- 某些字段有值域限制（如level: 1-100）

---

### 从XML文件导入数据

**场景**：策划给了你一个新的items.xml文件，需要导入到数据库

**步骤**：
1. 将XML文件放到 `data/TEMP/items.xml`
2. 打开主界面 → 左侧点击"items"
3. 点击"xmltodb导入"按钮
4. 等待导入完成
5. 刷新表格，查看新数据

**⚠️ 重要提示**：
- 导入会**覆盖**数据库中的同ID数据
- 导入前建议备份数据库（使用"dbtoxml导出"备份）
- 如果XML格式错误，会提示错误信息

---

## 🚨 常见问题排查

### 问题1：导出的XML文件服务器加载失败

**症状**：
- 服务器日志显示 "undefined token: __order_index"
- 或者显示 "undefined token: status_fx_slot_lv"

**原因**：
- XML中包含服务器不支持的字段

**解决方案**：
- ✅ **自动解决**：工具已集成服务器合规性过滤器，导出时会自动移除不兼容字段
- ✅ **验证修复**：重新导出一次，检查日志中是否有"服务器合规过滤"的提示

**查看过滤日志**：
```
✅ 服务器合规过滤 [items]: 处理了1234/1234条记录，移除44324个字段，修正0个字段值
```

---

### 问题2：表为空，无法导出

**症状**：
- 点击导出后提示"表为空，跳过导出"

**原因**：
- 数据库中该表没有数据

**解决方案**：
1. 先从XML导入数据 → "xmltodb导入"
2. 或者手动添加数据 → "新增"按钮

---

### 问题3：导出速度很慢

**症状**：
- 导出一个表需要5分钟以上

**原因**：
- 数据量太大（如items表有2万+条记录）

**解决方案**：
- ✅ 使用筛选功能，只导出需要的数据
- ✅ 使用批量导出时，会显示预警和预估时间
- ✅ 耐心等待，工具使用多线程并行处理

**性能提示**：
- 数据量 < 1000行：1-5秒
- 数据量 1000-10000行：5-30秒
- 数据量 10000-50000行：30秒-3分钟
- 数据量 > 50000行：3分钟以上（会有预警提示）

---

### 问题4：任务引用的物品不存在

**症状**：
- 服务器日志显示 "unknown item name: sword_v_u2_q_50a"

**原因**：
- `quest_random_rewards.xml` 中引用了 `items.xml` 中不存在的物品

**解决方案**：
1. **短期**：删除该任务奖励配置，或替换为存在的物品ID
2. **长期**：补全缺失的物品数据到items表

**工具支持**：
- ✅ 导出时会警告：`已知问题: 部分任务引用不存在的物品（pattern: *_q_*a）`

---

## 💡 高级技巧

### 技巧1：使用搜索快速定位

**场景**：在22,000条物品中找到"龙之宝剑"

**操作**：
1. 右侧表格 → 右上角搜索框
2. 输入"龙之宝剑"
3. 表格自动过滤，只显示匹配的记录

**支持的搜索方式**：
- 精确匹配：`name="龙之宝剑"`
- 模糊匹配：`name like "%龙%"`
- ID搜索：`id=100200`
- 范围搜索：`level between 40 and 50`

---

### 技巧2：使用机制浏览器快速导航

**场景**：想修改所有PVP相关的配置

**操作**：
1. 打开"Aion机制浏览器"
2. 点击"PVP系统"卡片
3. 查看所有PVP相关文件（7个）
4. 右键 → "批量导出"
5. 修改导出的XML文件
6. 批量导入回数据库

**优势**：
- 不需要记忆文件名
- 按游戏功能分类，直观明了
- 一键批量操作，省时高效

---

### 技巧3：使用Excel辅助批量修改

**场景**：批量修改100个NPC的等级

**操作**：
1. 工具中导出 `npcs.xml`
2. 使用XML转Excel工具（或直接用Excel打开XML）
3. 在Excel中批量修改level列
4. 保存为XML
5. 工具中导入回数据库

**注意**：
- 保持XML格式不变
- 不要修改id字段（主键）
- 保存为UTF-8编码

---

## 📊 数据文件位置

### 导出的XML文件位置

**默认路径**：`D:\workspace\dbxmlTool\data\TEMP\`

**文件列表示例**：
```
data/TEMP/
├── items.xml              (22,162条记录, 145 MB)
├── skill_base.xml         (技能数据, 12 MB)
├── npcs.xml               (NPC数据, 8 MB)
├── quest.xml              (任务数据, 5 MB)
├── pvp_rank.xml           (PVP等级, 12 KB)
└── ...
```

**修改导出路径**：
编辑 `src/main/resources/application.yml`
```yaml
file:
  exportDataPath: D:\MyCustomPath\  # 改为你想要的路径
```

---

### 配置文件位置

**表映射配置**：`src/main/resources/CONF/D/AionReal58/AionMap/XML/`

**示例**：
```
CONF/D/AionReal58/AionMap/XML/
├── items.json              - items表的映射配置
├── skill_base.json         - skill_base表的映射配置
├── npcs.json               - npcs表的映射配置
└── ...
```

**⚠️ 不建议修改配置文件**，除非你知道自己在做什么！

---

## 🛡️ 数据安全建议

### 1. 定期备份

**备份数据库**：
```bash
mysqldump -u root -p xmldb_suiyue > backup_2025-12-29.sql
```

**备份XML**：
- 使用"批量导出"功能，导出所有数据到XML
- 将 `data/TEMP/` 目录复制到安全位置

### 2. 测试环境先试

**流程**：
1. 先在测试服务器上导入修改的XML
2. 启动测试服务器，查看日志
3. 确认无错误后，再应用到正式服务器

### 3. 版本控制

**建议**：
- 每次重大修改后，使用Git记录变更
- 提交前写清楚修改内容
- 例如：`feat: 提升50级宝剑的攻击力从200改为250`

---

## 📞 获取帮助

### 工具内帮助

- **工具提示**：鼠标悬停在按钮上，会显示功能说明
- **错误提示**：操作失败时，会显示详细错误信息
- **日志查看**：底部日志面板显示所有操作记录

### 文档资源

- **本指南**：`docs/DESIGNER_QUICK_START_GUIDE.md`
- **技术文档**：`CLAUDE.md`
- **服务器兼容性分析**：`docs/SERVER_COMPLIANCE_ANALYSIS.md`
- **机制归类报告**：`docs/SERVER_XML_MECHANISM_CLASSIFICATION.md`

---

## 🎓 培训建议

### 新手培训流程（2小时）

**第1小时：基础操作**
1. 启动工具（10分钟）
2. 浏览左侧文件树（10分钟）
3. 查看和搜索数据（15分钟）
4. 修改一条数据（15分钟）
5. 导出XML文件（10分钟）

**第2小时：进阶操作**
1. 使用机制浏览器（15分钟）
2. 批量导出操作（15分钟）
3. XML导入操作（15分钟）
4. 常见问题排查（15分钟）

**实操练习**：
- 练习1：修改一个物品的属性
- 练习2：批量导出PVP系统的所有配置
- 练习3：从XML导入一个新的任务

---

## ✅ 快速检查清单

### 导出前检查

- [ ] 数据已保存到数据库
- [ ] 确认要导出的表名正确
- [ ] 预估导出时间（数据量大时）
- [ ] 确认导出路径有足够空间

### 导出后检查

- [ ] XML文件已生成（检查 `data/TEMP/` 目录）
- [ ] 文件大小正常（不为0字节）
- [ ] 查看导出日志，确认无错误
- [ ] 检查是否有"自动移除字段"的提示

### 服务器部署前检查

- [ ] 备份服务器原有的XML文件
- [ ] 在测试服务器上先测试
- [ ] 查看服务器启动日志
- [ ] 确认无 "undefined token" 或 "unknown item" 错误

---

**祝你使用愉快！遇到问题随时查阅本指南或联系技术支持。** 🎉
